---
import Base from '../layouts/Base.astro';

// Load team data from Planning Center sync
let pastor = null;
try {
  const teamData = await import('../data/team.json');
  pastor = (teamData.team || []).find(m => m.slug === 'andrew_coffield');
} catch (e) {
  console.log('Team data not yet generated');
}

// Data from Planning Center
const pastorName = pastor?.displayName || "Andrew Coffield";
const pastorImage = pastor?.image || "/team/andrew_coffield.jpg";
const pastorBio = pastor?.bio || "";

// Split bio into paragraphs (split on double newlines or single newlines)
const bioParagraphs = pastorBio
  .split(/\n\n|\n/)
  .map(p => p.trim())
  .filter(p => p.length > 0);
---

<Base title="Our Pastor" description="Meet Pastor Andrew Coffield, senior pastor at River of Life Church in Henry, IL." headerScrolled={true}>
  <section class="pastor-letter">
    <div class="pastor-letter-content">
      <div class="letter-text">
        {bioParagraphs.length > 0 ? (
          bioParagraphs.map(paragraph => (
            <p>{paragraph}</p>
          ))
        ) : (
          <>
            <p>
              River of Life is an Apostolic Pentecostal church located in Henry, Illinois.
              We are a community of believers passionate about sharing the love of Jesus Christ
              and helping people discover their purpose in Him.
            </p>
            <p>
              My wife Chelsea and I feel honored and blessed to serve as pastors of this
              incredible church family. We'd love to meet you!
            </p>
          </>
        )}

        <div class="signature-block">
          <img src="/pastor-signature.png" alt="Pastor Andrew's signature" class="signature-image" />
          <p class="pastor-name">Andrew & Chelsea Coffield</p>
          <p class="pastor-title">Senior Pastors, River of Life</p>
        </div>
      </div>

      <div class="pastor-photo">
        <img src={pastorImage} alt={`Pastor ${pastorName}`} />
      </div>
    </div>
  </section>
</Base>

<style>
  .pastor-letter {
    position: relative;
    background: white;
    min-height: 100vh;
  }

  .pastor-letter-content {
    display: block;
    width: 50%;
    min-height: 100vh;
  }

  .letter-text {
    padding: calc(var(--header-height, 110px) + 3rem) 4rem 4rem 2rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    min-height: calc(100vh - var(--header-height, 110px) - 7rem);
    max-width: 650px;
    margin-left: auto;
  }

  .letter-text p {
    color: #333;
    font-size: 1.05rem;
    line-height: 1.8;
    margin-bottom: 1.5rem;
  }

  .signature-block {
    margin-top: 1.5rem;
  }

  .signature-image {
    height: 60px;
    width: auto;
    margin-bottom: 0.5rem;
  }

  .pastor-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-navy);
    margin-bottom: 0.25rem !important;
  }

  .pastor-title {
    font-size: 0.95rem;
    color: #666;
    margin-bottom: 0 !important;
  }

  .pastor-photo {
    position: fixed;
    top: 0;
    right: 0;
    width: 50%;
    height: 100vh;
    overflow: hidden;
    z-index: 0;
  }

  .pastor-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center top;
    clip-path: polygon(8% 0, 100% 0, 100% 100%, 0% 100%);
  }


  @media (max-width: 1024px) {
    .letter-text {
      padding: calc(var(--header-height, 110px) + 2rem) 3rem 2.5rem 1.5rem;
    }
  }

  @media (max-width: 900px) {
    .pastor-letter {
      min-height: auto;
    }

    .pastor-letter-content {
      width: 100%;
      min-height: auto;
    }

    .pastor-photo {
      position: relative;
      top: auto;
      right: auto;
      width: 100%;
      height: auto;
      aspect-ratio: 4 / 3;
    }

    .pastor-photo img {
      clip-path: none;
      object-position: center 25%;
    }

    .letter-text {
      padding: 2.5rem 2rem;
      max-width: none;
      margin-left: 0;
      min-height: auto;
    }
  }

  @media (max-width: 600px) {
    .pastor-photo {
      aspect-ratio: 1 / 1;
    }

    .letter-text {
      padding: 2rem 1.5rem;
    }

    .letter-text p {
      font-size: 1rem;
    }
  }
</style>

<style is:global>
  /* Pastor page specific */
  body:has(.pastor-letter) {
    background: white;
  }

  body:has(.pastor-letter) main {
    padding: 0 !important;
    margin: 0 !important;
  }

  body:has(.pastor-letter) footer {
    position: relative;
    z-index: 1;
  }
</style>
