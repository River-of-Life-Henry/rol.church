---
/**
 * Events Page
 *
 * Lists all upcoming events grouped by month.
 * Events are filtered by end time - once an event ends, it's removed.
 */

import Base from '../../layouts/Base.astro';
import PageHero from '../../components/shared/PageHero.astro';
import EventList from '../../components/shared/EventList.astro';
import { filterEventsForDisplay, groupEventsByMonth } from '../../utils/eventFilters';

// Load events data and filter
let events: any[] = [];
try {
  const eventsData = await import('../../data/events.json');
  const allEvents = eventsData.events || [];
  events = filterEventsForDisplay(allEvents);
} catch (e) {
  console.log('Events data not yet generated');
}

const groupedEvents = groupEventsByMonth(events);
---

<Base title="Events" description="See what's happening at River of Life. View our calendar of upcoming events and activities.">
  <PageHero title="Events" image="/hero/4.jpg" />

  <section class="events-content">
    <div class="container">
      {events.length === 0 && (
        <p class="no-events">No upcoming events at this time. Check back soon!</p>
      )}

      {Object.entries(groupedEvents).map(([month, monthEvents]) => (
        <div class="month-group">
          <h2 class="month-header">{month}</h2>
          <EventList events={monthEvents} />
        </div>
      ))}
    </div>
  </section>

</Base>

<style>
  .events-content {
    padding: 3rem 2rem;
    background: white;
  }

  .events-content .container {
    max-width: 900px;
    margin: 0 auto;
  }

  .no-events {
    text-align: center;
    color: var(--color-text-light);
    font-size: 1.1rem;
    padding: 3rem;
  }

  .month-group {
    margin-bottom: 3rem;
  }

  .month-header {
    color: var(--color-navy);
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--color-gold);
  }
</style>
